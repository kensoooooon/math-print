{% extends 'math_print/base.html' %}

{% block script %}

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: {
            inlineMath: [["$","$"],["\\(","\\)"]],
            displayMath: [["$$","$$"],["\\[","\\]"]]
        }
        });
</script>

<script>
function showAnswer(){
    var nodes = document.getElementsByClassName('answer');
    for(var i = 0; i < nodes.length; i++){
        nodes[i].style.visibility = 'visible';
    }
}
function refresh() {
  var url = location.origin;
  var pathname = location.pathname;
  var hash = location.hash;

  location = url + pathname + '?application_refresh=' + (Math.random() * 100000) + hash;
}
</script>

<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script>
  window.addEventListener("load", draw);

  function drawLine(stage, start_x, start_y, end_x, end_y) {
      var graphic = new createjs.Graphics();
      graphic.beginStroke("#000000");
      graphic.moveTo(start_x, start_y);
      graphic.lineTo(end_x, end_y);
      graphic.endStroke();
      var shape = new createjs.Shape(graphic);
      stage.addChild(shape);

  }

  function drawLineWithAngle(stage, start_x, start_y, angle, radius=200) {
      // draw line detemined by angle
      var graphic = new createjs.Graphics();
      graphic.beginStroke("#000000");
      graphic.moveTo(start_x, start_y);
      var radian = angle * Math.PI / 180;
      var end_x = start_x + radius * Math.cos(radian);
      var end_y = start_y + radius * Math.sin(radian);
      graphic.lineTo(end_x, end_y);
      graphic.endStroke();
      var shape = new createjs.Shape(graphic);
      stage.addChild(shape);
  }

  function drawArc(stage, center_x, center_y, radius, start_angle, end_angle, anticlockwise=false) {
      var graphic = new createjs.Graphics();
      graphic.beginStroke("#000000");
      var start_radian = start_angle * Math.PI / 180;
      var end_radian = end_angle * Math.PI / 180;
      graphic.arc(center_x, center_y, radius, start_radian, end_radian, anticlockwise);
      var shape = new createjs.Shape(graphic);
      stage.addChild(shape);
  }
  
  function drawDegreeCharacter(stage, x, y, character) {
    //文字オブジェクトを作成する
    var text = new createjs.Text(character, "20px Arial", "#000000");
    //描画位置の指定
    text.x = x;
    text.y = y;
    stage.addChild(text);
  }

  function random_vertical_angle_draw (stage, answer_angle) {
    console.log("answer_angle: "+answer_angle);
    var max_angle = (180 - answer_angle) - 10; // 10 is buffer. no much evidence.
    var random_angle = Math.floor(Math.random() * (max_angle + 1 - 20) + 20);
    console.log("random_angle: "+random_angle);
    var remained_angle = 180 - (answer_angle + random_angle);
    console.log("remained_angle: "+remained_angle);
    // drawLine(stage, 30, 160, 610, 160);
    drawLine(stage, 15, 80, 305, 80);
    // drawLineWithAngle(stage, 320, 160, -1*random_angle);
    drawLineWithAngle(stage, 160, 80, -1*random_angle);
    // drawLineWithAngle(stage, 320, 160, -1*random_angle+180);
    drawLineWithAngle(stage, 160, 80, -1*random_angle+180);
    // drawArc(stage, 320, 160, 50, 0, -1*random_angle, anticlockwise=true);
    drawArc(stage, 160, 80, 25, 0, -1*random_angle, anticlockwise=true);
    // drawDegreeCharacter(stage, 320+100, 160-40, random_angle+"°");
    drawDegreeCharacter(stage, 160+50, 80-20, random_angle+"°");
    // drawLineWithAngle(stage, 320, 160, -1*random_angle-remained_angle);
    drawLineWithAngle(stage, 160, 80, -1*random_angle-remained_angle);
    // drawLineWithAngle(stage, 320, 160, -1*random_angle-remained_angle+180);
    drawLineWithAngle(stage, 160, 80, -1*random_angle-remained_angle+180);
    // drawArc(stage, 320, 160, 50, -1*random_angle+180, -1*random_angle-remained_angle+180, anticlockwise=true);
    drawArc(stage, 160, 80, 25, -1*random_angle+180, -1*random_angle-remained_angle+180, anticlockwise=true);
    // drawDegreeCharacter(stage, 320-10, 160+120, remained_angle+"°");
    drawDegreeCharacter(stage, 160-5, 80+60, remained_angle+"°");
    // drawArc(stage, 320, 160, 50, -1*random_angle-remained_angle, 180, anticlockwise=true);
    drawArc(stage, 160, 80, 25, -1*random_angle-remained_angle, 180, anticlockwise=true);
    // drawDegreeCharacter(stage, 320-100, 160-40, "x");
    drawDegreeCharacter(stage, 160-50, 80-20, "x");
    stage.update();
  }

  function random_parallel_angle_draw (stage, answer_angle) {
    // var docking_x = 150;
    var docking_x = 75;
    // var docking_y = 160;
    var docking_y = 80;
    // drawLine(stage, 10, 310, 630, 310);
    drawLine(stage, 5, 155, 315, 155);
    // drawLine(stage, 10, 10, 630, 10);
    drawLine(stage, 5, 5, 315, 5);
    var random_angle = Math.floor(Math.random() * ((answer_angle - 20) + 1 - 20) + 20);
    var angle1 = random_angle;
    var radian1 = angle1 * Math.PI / 180;
    // var radius1 = 150 / Math.sin(radian1);
    var radius1 = 75 / Math.sin(radian1);
    drawLineWithAngle(stage, docking_x, docking_y, angle1, radius=radius1);
    // drawArc(stage, docking_x, docking_y, 50, 0, angle1);
    drawArc(stage, docking_x, docking_y, 25, 0, angle1);
    // the phase to calculate end line point.
    var end_x1 = docking_x + radius1 * Math.cos(radian1);
    var end_y1 = docking_y + radius1 * Math.sin(radian1);
    // drawArc(stage, end_x1, end_y1, 50, 180, 180+angle1);
    drawArc(stage, end_x1, end_y1, 25, 180, 180+angle1);
    console.log("angle1: " + angle1);
    // drawDegreeCharacter(stage, end_x1-100, end_y1-30, angle1+"°");
    drawDegreeCharacter(stage, end_x1-70, end_y1-20, angle1+"°");
    var angle2 = answer_angle - random_angle;
    var radian2 = angle2 * Math.PI / 180;
    // var radius2 = 150 / Math.sin(radian2);
    var radius2 = 75 / Math.sin(radian2);

    drawLineWithAngle(stage, docking_x, docking_y, -angle2, radius=radius2);
    // drawArc(stage, docking_x, docking_y, 50, 0, -angle2, anticlockwise=true);
    drawArc(stage, docking_x, docking_y, 25, 0, -angle2, anticlockwise=true);
    // the phase to calculate end line point.
    var end_x2 = docking_x + radius2 * Math.cos(-radian2);
    var end_y2 = docking_y + radius2 * Math.sin(-radian2);
    // drawArc(stage, end_x2, end_y2, 50, 180-angle2, 180);
    drawArc(stage, end_x2, end_y2, 25, 180-angle2, 180);
    console.log("angle2: " + angle2);
    // drawDegreeCharacter(stage, end_x2-100, end_y2+10, angle2+"°");
    drawDegreeCharacter(stage, end_x2-70, end_y2+5, angle2+"°");
    // drawDegreeCharacter(stage, docking_x+60, docking_y-20, "x°");
    drawDegreeCharacter(stage, docking_x+30, docking_y-10, "x°");
    stage.update();
  }

  function sample_draw () {
    var stage = new createjs.Stage("sample_canvas");
    random_parallel_angle_draw(stage, 150);
  }

  function call_problem_maker (stage, problem_type, answer_angle) {
    if (problem_type == "corresponding_and_alternate_angle") {
      random_parallel_angle_draw(stage, answer_angle);
    }
    else if (problem_type == "interior_and_exterior_angle") {
      random_vertical_angle_draw(stage, answer_angle);
    }
  }

  function draw() {
    {% for information_tuple in problem_type_and_answer_angle_tuple_list %}
    var container_div = document.createElement("div");
    container_div.className = "container-fluid";

    var row_container = document.createElement("div");
    row_container.className = "row";

    var left_div = document.createElement("div");
    left_div.className = "col-md-6";

    var left_canvas = document.createElement('canvas');
    var left_canvas_id = "left_canvas" + {{ forloop.counter }};
    left_canvas.id = left_canvas_id;
    // left_canvas.width = 640;
    left_canvas.width = 320;
    // left_canvas.height = 320;
    left_canvas.height = 160;
    left_canvas.style = "background-color:#CCFFFF";
    // add left answer to left_div
    var left_answer = document.createElement('p');
    left_answer.innerHTML = "\({{ information_tuple.0.angle }}\)";

    var right_div = document.createElement("div");
    right_div.className = "col-md-6";

    var right_canvas = document.createElement('canvas');
    var right_canvas_id = "right_canvas" + {{ forloop.counter }};
    right_canvas.id = right_canvas_id;
    // right_canvas.width = 640;
    right_canvas.width = 320;
    // right_canvas.height = 320;
    right_canvas.height = 160;
    right_canvas.style = "background-color:#CCFFFF";

    // insert part
    // can accquire before adding?<-another part check<<-may be not.
    left_div.appendChild(left_canvas);
    // add left answer to left_div
    var left_answer = document.createElement('p');
    left_answer.innerHTML = "\\\(x = {{ information_tuple.0.angle }} ^ \\\circ \\\)";
    left_div.appendChild(left_answer);

    right_div.appendChild(right_canvas);
    // add right answer to right_div
    var right_answer = document.createElement('p');
    right_answer.innerHTML = "\\\(x = {{ information_tuple.1.angle }} ^ \\\circ \\\)";
    right_div.appendChild(right_answer);

    row_container.appendChild(left_div);
    row_container.appendChild(right_div);
    container_div.appendChild(row_container);
    document.body.appendChild(container_div);

    var left_stage = new createjs.Stage(left_canvas_id);
    call_problem_maker(left_stage, "{{ information_tuple.0.problem_type }}", {{ information_tuple.0.angle }});
    var right_stage = new createjs.Stage(right_canvas_id);
    console.log("--------------------------------");
    call_problem_maker(right_stage, "{{ information_tuple.1.problem_type }}", {{ information_tuple.1.angle }});
    console.log("--------------------------------");
    {% endfor %}
  }

  function check_draw () {
    var canvas = document.createElement("canvas");
    var canvas_id = "sample_canvas";
    canvas.id = canvas_id;
    var stage = new createjs.Stage("sample_canvas");
    call_problem_maker(stage, "corresponding_and_alternate_angle", 45);
    document.body.appendChild(canvas);
  }
</script>
{% endblock %}

{% block css %}
{% endblock %}

{% block title %}
角度を求める
{% endblock %}

{% block hero_unit %}
<div class="p-3 p-sm-5 mb-4 bg-img hero_unit">
    <div class="container">
        <h1 class="display-4">ようこそ!</h1>
        <p class="text-dark">角度を求める</p>
    </div>
</div>
{% endblock %}

{% block body %}
<ol>
  <div class="container-fluid">
      <div class="row">
          <div class="col-md-6">
              <li>
                  <!--canvas?-->
                  <p class="answer" style="visibility:hidden;">
                      \(x = 200 ^{\circ} \)
                  </p>
              </li>
          </div>
          <div class="col-md-6">
              <li>
                  <!--canvas?-->
                  <p class="answer" style="visibility:hidden;">

                  </p>
              </li>
          </div>
      </div>
  </div>
</ol>

{% if used_formula_list %}
  {% for formula in used_formula_list %}
      <p class="formula text-center" style="visibility:hidden;">{{formula}}</p>
  {% endfor %}
{% else %}
  <br>
  <br>
  <br>
{% endif %}

<div class="d-grid gap-3 col-6 mx-auto">
  <button class="btn btn-outline-success" type="button" onclick="showAnswer()">答えを表示する</button>
  <button class="btn btn-outline-success" type="button" onclick="location.reload(false)">もう一度解く</button>
  <a href="{% url 'junior_highschool2' %}" class="btn btn-primary" type="button">問題選択へ戻る</a>
  <a href="{% url 'index' %}" class="btn btn-primary" type="button">トップへ戻る</a>
</div>
<footer class="container-fluid print_footer">
  <small><a href="#">© 2022 有明学習振興</a></small>
</footer>
{% endblock %}